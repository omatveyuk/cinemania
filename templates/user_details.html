{% extends 'base.html' %}
{% block content %}
<!-- movie object -->

<!-- It's container-fluid so it spans the whole page. -->
<div class="container-fluid" id="user-details"> 

  <div class="row">
    <div class="col-xs-12">
      <h3><b>{% if user.name %}Hi {{ user.name }},{% endif %}</b></h3>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12">
      <b>Your favorite genre{% if genres|length > 1 %}s{% endif %}: </b>
      {% if genres|length != 0 %}
        {% if genres|length > 1 %}
          {% for genre in genres[:-1] %} 
            {{ genre.name }},&nbsp;
          {% endfor %} 
        {% endif %}
        {{ genres[-1].name }}
      {% endif %}
    </div>
  </div>

  <div class="row">
    <div class="col-xs-1">
      <b>Seen:</b>
    </div>
    <div class="col-xs-offset-2 col-xs-2" align="right">
      <b>Your Rating</b>
    </div>
  </div>

  {% for movie in movies %}
    <div class="row">
      <div class="col-xs-1">  
        <img src="{{ posters_url }}{{ movie.poster_url }}" class="img-thumbnail" alt="Movie poster" width="60%" height="60%">
      </div>
      <div class="col-xs-3">
        <a href="{{ url_for('get_movie', movie_id= movie.themoviedb_id) }}">{{ movie.title }}</a>
      </div>
      <div class="col-xs-1" align="center">
        {% if movie.rating %}
          <div class= "prime-circle">
            {{ movie.rating }}
          </div>
        {% endif %}
      </div>
      <div class="col-xs-5">
        <a class="change-rating" data-id="{{ movie.movie_id }}" style="font-size: 12px">Change rating...</a>
        <form class="change-rating" id="movie_{{ movie.movie_id }}" data-id="{{ movie.movie_id }}" hidden>
            <input type="radio" name="rating" value="1" {% if movie.rating == 1 %}checked="checked"{% endif %}> 1&nbsp;&nbsp;
            <input type="radio" name="rating" value="2" {% if movie.rating == 2 %}checked="checked"{% endif %}> 2&nbsp;&nbsp;
            <input type="radio" name="rating" value="3" {% if movie.rating == 3 %}checked="checked"{% endif %}> 3&nbsp;&nbsp;
            <input type="radio" name="rating" value="4" {% if movie.rating == 4 %}checked="checked"{% endif %}> 4&nbsp;&nbsp;
            <input type="radio" name="rating" value="5" {% if movie.rating == 5 %}checked="checked"{% endif %}> 5&nbsp;&nbsp;
            <input type="radio" name="rating" value="6" {% if movie.rating == 6 %}checked="checked"{% endif %}> 6&nbsp;&nbsp;
            <input type="radio" name="rating" value="7" {% if movie.rating == 7 %}checked="checked"{% endif %}> 7&nbsp;&nbsp;
            <input type="radio" name="rating" value="8" {% if movie.rating == 8 %}checked="checked"{% endif %}> 8&nbsp;&nbsp;
            <input type="radio" name="rating" value="9" {% if movie.rating == 9 %}checked="checked"{% endif %}> 9&nbsp;&nbsp;
            <input type="radio" name="rating" value="10" {% if movie.rating == 10 %}checked="checked"{% endif %}> 10&nbsp;&nbsp;&nbsp;&nbsp;
            <input type="submit">
        </form>
      </div>    
    </div>
  {% endfor %}
  
</div>  

<script src="http://code.jquery.com/jquery.js"></script>
<script>
  "use strict";


  function showNewMovieRating(result){
    alert('ShowNewMovieRating');
  }

  function getRadioVal(form, name) {
      var val;
      // get list of radio buttons with specified name
      var radios = form.elements[name];
      
      // loop through list of radio buttons
      for (var i=0, len=radios.length; i<len; i++) {
          if ( radios[i].checked ) { // radio checked?
              val = radios[i].value; // if so, hold its value in val
              break; // and break out of for loop
          }
      }
      return val; // return value of checked radio or undefined if none checked
  }

  function changeMovieRating(evt) {
    debugger;
    var movie_id = $(this).attr('data-id');
    var rating = $('#movie_'+movie_id).elemets['#movie_'+movie_id].value;
    //var form = document.getElementById("test");
    //alert(form.elements["test"].value);
    //var rating = $('#movie_'+movie_id).get('checked');
    //var rating = $('idinput[name="rating"]:checked').val()

    $.get('/change_rating.json', {'rating': $('input[name="rating"]:checked').val(),
                                  'movie_id': $(this).attr('data-id')}, showNewMovieRating);
  }

  $('a.change-rating').click(function(){
      var movie_id = $(this).attr('data-id');
      $('#movie_'+movie_id).show();
    });

  $('form.change-rating').on('submit', changeMovieRating); 


</script>

{% endblock %}
















